<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Pro Max</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB7vbQ1BQya7SWIsGByt6pLtnkX-0WG1I8",
            authDomain: "llla-f3cd0.firebaseapp.com",
            projectId: "llla-f3cd0",
            storageBucket: "llla-f3cd0.firebasestorage.app",
            messagingSenderId: "976940645729",
            appId: "1:976940645729:web:0a6a820a6a76156cf11920"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let myWords = [];

        window.loginWithGoogle = async () => {
            try { await signInWithPopup(auth, provider); } 
            catch (e) { alert("–û—à–∏–±–∫–∞: " + e.message); }
        };

        window.logOut = () => signOut(auth);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('authSection').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                await loadData();
            } else {
                document.getElementById('authSection').style.display = 'block';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        async function loadData() {
            const docRef = doc(db, "users", currentUser.uid);
            const docSnap = await getDoc(docRef);
            myWords = docSnap.exists() ? (docSnap.data().words || []) : [];
            initCard();
        }

        async function saveData() {
            await setDoc(doc(db, "users", currentUser.uid), { words: myWords });
        }

        // –û–ó–í–£–ß–ö–ê
        window.speak = (text) => {
            const msg = new SpeechSynthesisUtterance();
            msg.text = text;
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        };

        window.addWord = async () => {
            const en = document.getElementById('enIn').value.trim();
            const ru = document.getElementById('ruIn').value.trim();
            if(en && ru) {
                myWords.push({en, ru});
                await saveData();
                document.getElementById('enIn').value = "";
                document.getElementById('ruIn').value = "";
                alert("–°–ª–æ–≤–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
            }
        };

        let currentCard = null;
        window.initCard = () => {
            const t = document.getElementById('cardText');
            if(!myWords.length) { t.innerText = "–î–æ–±–∞–≤—å —Å–ª–æ–≤–∞!"; return; }
            currentCard = myWords[Math.floor(Math.random()*myWords.length)];
            t.innerText = currentCard.ru;
            t.classList.remove('flipped');
        };

        window.flipCard = () => {
            const t = document.getElementById('cardText');
            if (t.innerText === currentCard.ru) {
                t.innerText = currentCard.en;
                t.classList.add('flipped');
                speak(currentCard.en); // –û–∑–≤—É—á–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ
            } else {
                t.innerText = currentCard.ru;
                t.classList.remove('flipped');
            }
        };

        window.showTab = (id) => {
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        };
    </script>
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background: radial-gradient(circle, #1b1b2f 0%, #020205 100%); 
            color: white; 
            text-align: center; 
            margin: 0; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .box { 
            background: rgba(22, 33, 62, 0.8); 
            padding: 30px; 
            border-radius: 30px; 
            width: 90%;
            max-width: 400px; 
            backdrop-filter: blur(10px);
            border: 2px solid #e94560;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }
        h2 { color: #e94560; text-transform: uppercase; letter-spacing: 2px; }
        input { 
            width: 100%; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 15px; 
            border: 1px solid #e94560; 
            background: #16213e; 
            color: white;
            box-sizing: border-box;
        }
        button { 
            width: 100%; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 15px; 
            border: none; 
            background: #e94560; 
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
        }
        .nav-btn { width: auto; background: #533483; padding: 10px 20px; font-size: 14px; flex: 1; margin: 5px; }
        .card { 
            background: #1a1a2e; 
            height: 200px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 32px; 
            border-radius: 25px; 
            cursor: pointer; 
            margin: 20px 0; 
            border: 3px solid #e94560;
            transition: 0.3s;
        }
        .card.flipped { color: #00d4ff; border-color: #00d4ff; text-shadow: 0 0 10px #00d4ff; }
        .google-btn { background: white; color: #333; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .tab { display: none; }
    </style>
</head>
<body>

    <div id="authSection" class="box">
        <h2>English Pro</h2>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
        </button>
    </div>

    <div id="mainApp" style="display:none">
        <div style="display: flex; width: 90%; max-width: 400px; margin-bottom: 10px;">
            <button class="nav-btn" onclick="showTab('learn')">–£—á–∏—Ç—å</button>
            <button class="nav-btn" onclick="showTab('add')">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="nav-btn" onclick="logOut()" style="background: #111;">üö™</button>
        </div>

        <div class="box">
            <div id="learn" class="tab" style="display: block;">
                <div class="card" id="cardText" onclick="flipCard()">...</div>
                <button onclick="initCard()">–°–õ–ï–î–£–Æ–©–ï–ï ‚Üí</button>
            </div>

            <div id="add" class="tab">
                <h3>–ù–û–í–û–ï –°–õ–û–í–û</h3>
                <input id="enIn" placeholder="English Word">
                <input id="ruIn" placeholder="–†—É—Å—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥">
                <button onclick="addWord()">–°–û–•–†–ê–ù–ò–¢–¨ –í –û–ë–õ–ê–ö–û</button>
            </div>
        </div>
    </div>

</body>
</html>
