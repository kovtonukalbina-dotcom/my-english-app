<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Pro Sync</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB08h5m5cqOcRXNNzHhnIFLTLAjd0kk754",
            authDomain: "bebe-615c2.firebaseapp.com",
            projectId: "bebe-615c2",
            storageBucket: "bebe-615c2.firebasestorage.app",
            messagingSenderId: "913901689922",
            appId: "1:913901689922:web:e72c374ac142486e8061db"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({ prompt: 'select_account' });

        let myWords = [];

        // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google (–≤—ã–±–æ—Ä –∞–∫–∫–∞—É–Ω—Ç–∞)
        window.login = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (e) {
                alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + e.message);
            }
        };

        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authBlock').style.display = 'none';
                document.getElementById('appBlock').style.display = 'block';
                await loadData(user.uid);
            } else {
                document.getElementById('authBlock').style.display = 'flex';
                document.getElementById('appBlock').style.display = 'none';
            }
        });

        async function loadData(uid) {
            const snap = await getDoc(doc(db, "users", uid));
            if (snap.exists()) {
                myWords = snap.data().words || [];
            } else {
                myWords = [];
                await setDoc(doc(db, "users", uid), { words: [] });
            }
            initCard();
        }

        window.addWord = async () => {
            const en = document.getElementById('enIn').value;
            const ru = document.getElementById('ruIn').value;
            if (en && ru) {
                myWords.push({ en, ru });
                const user = auth.currentUser;
                await updateDoc(doc(db, "users", user.uid), { words: myWords });
                document.getElementById('enIn').value = '';
                document.getElementById('ruIn').value = '';
                alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–æ!");
            }
        };

        window.initCard = () => {
            const cardBox = document.getElementById('cardDisplay');
            if (!myWords.length) {
                cardBox.innerHTML = "<div style='font-size:16px; color:#999'>–î–æ–±–∞–≤—å —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ ‚ûï</div>";
                return;
            }
            const word = myWords[Math.floor(Math.random() * myWords.length)];
            cardBox.innerText = word.ru;
            cardBox.onclick = () => {
                cardBox.innerText = (cardBox.innerText === word.ru ? word.en : word.ru);
                cardBox.style.color = (cardBox.innerText === word.en ? "#3498db" : "#333");
            };
            cardBox.style.color = "#333";
        };

        window.showTab = (id) => {
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        };
    </script>
    <style>
        body { background: #121225; color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* –ë–ª–æ–∫ –≤—Ö–æ–¥–∞ */
        #authBlock { height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        .box { background: #fff; color: #333; padding: 25px; border-radius: 25px; width: 100%; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); box-sizing: border-box; }
        
        h2 { color: #fff; margin-bottom: 30px; font-size: 32px; }
        
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; outline: none; }
        
        button { width: 100%; padding: 16px; margin: 10px 0; border-radius: 18px; border: none; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.2s; }
        
        .btn-main { background: #2ecc71; color: #fff; }
        .btn-google { background: #fff; color: #333; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-nav { background: #3498db; color: #fff; width: 48%; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ */
        .card { background: #f9f9f9; height: 180px; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; border-radius: 20px; margin: 20px 0; cursor: pointer; text-align: center; padding: 20px; box-sizing: border-box; border: 2px solid #eee; transition: 0.3s; }
        .card:active { transform: scale(0.95); }

        .nav { display: flex; justify-content: space-between; width: 100%; max-width: 350px; margin-bottom: 20px; }
        
        .exit-btn { background: #e74c3c; color: #fff; margin-top: 40px; width: 100px; padding: 10px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="authBlock">
        <h2>English Pro üöÄ</h2>
        <div class="box" style="background: transparent; box-shadow: none; padding: 0;">
            <button class="btn-google" onclick="login()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
                –í—ã–±—Ä–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
            </button>
        </div>
    </div>

    <div id="appBlock" style="display:none; width: 100%; max-width: 350px;">
        <div class="nav">
            <button class="btn-nav" onclick="showTab('learn')">–£—á–∏—Ç—å</button>
            <button class="btn-nav" onclick="showTab('add')">‚ûï –°–ª–æ–≤–æ</button>
        </div>

        <div class="box">
            <div id="learn" class="tab">
                <div class="card" id="cardDisplay">–ù–∞–∂–º–∏</div>
                <button class="btn-main" onclick="initCard()">–°–ª–µ–¥—É—é—â–µ–µ ‚Üí</button>
            </div>

            <div id="add" class="tab" style="display:none">
                <input id="enIn" placeholder="English">
                <input id="ruIn" placeholder="–†—É—Å—Å–∫–∏–π">
                <button class="btn-main" onclick="addWord()">–í –æ–±–ª–∞–∫–æ</button>
            </div>
        </div>

        <div style="display: flex; justify-content: center;">
            <button class="exit-btn" onclick="logout()">–í—ã—Ö–æ–¥</button>
        </div>
    </div>

</body>
</html>
