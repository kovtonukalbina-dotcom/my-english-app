<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Pro Sync</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB7vbQ1BQya7SWIsGByt6pLtnkX-0WG1I8",
            authDomain: "llla-f3cd0.firebaseapp.com",
            projectId: "llla-f3cd0",
            storageBucket: "llla-f3cd0.firebasestorage.app",
            messagingSenderId: "976940645729",
            appId: "1:976940645729:web:0a6a820a6a76156cf11920"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let state = { words: [] };
        let currentWord = null;

        // –§—É–Ω–∫—Ü–∏—è –æ–∑–≤—É—á–∫–∏
        window.speak = (text) => {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            window.speechSynthesis.speak(utterance);
        };

        window.login = () => signInWithPopup(auth, provider).catch(e => alert(e.message));
        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                if (snap.exists()) state = snap.data();
                else await setDoc(userRef, state);
                showTab('cardsTab');
            } else {
                document.getElementById('authScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if (id === 'cardsTab') drawCard();
        };

        // –õ–û–ì–ò–ö–ê –ö–ê–†–¢–û–ß–ï–ö: –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ –∏ –†–∞–Ω–¥–æ–º–Ω–æ
        window.drawCard = () => {
            const cardBox = document.getElementById('cardBox');
            if (!state.words || state.words.length === 0) {
                cardBox.innerHTML = "<p style='color:#999'>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.</p>";
                return;
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ
            currentWord = state.words[Math.floor(Math.random() * state.words.length)];
            
            // –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å —Ä—É—Å—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã (–∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Å—Ä–∞–∑—É –∑–≤—É–∫)
            // –î–∞–≤–∞–π –Ω–∞—á–Ω–µ–º —Å —Ä—É—Å—Å–∫–æ–π, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ –±—ã–ª –∑–≤—É–∫
            cardBox.innerHTML = `
                <div class="card-display" id="activeCard" data-side="ru">
                    ${currentWord.ru}
                </div>`;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞
            document.getElementById('activeCard').onclick = function() {
                if (this.getAttribute('data-side') === 'ru') {
                    this.innerText = currentWord.en;
                    this.setAttribute('data-side', 'en');
                    speak(currentWord.en); // –û–∑–≤—É—á–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
                } else {
                    this.innerText = currentWord.ru;
                    this.setAttribute('data-side', 'ru');
                }
            };
        };

        window.addBulkWords = async () => {
            const area = document.getElementById('bulkInput');
            const text = area.value.trim();
            if (!text) return alert("–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫!");

            const lines = text.split('\n');
            let added = 0;
            lines.forEach(line => {
                const parts = line.split(';');
                if (parts.length >= 2) {
                    state.words.push({ en: parts[0].trim(), ru: parts[1].trim() });
                    added++;
                }
            });

            if (added > 0) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { words: state.words });
                area.value = '';
                alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ: ${added}`);
                showTab('cardsTab');
            }
        };

    </script>
    <style>
        body { background: #0f0f1e; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; text-align: center; }
        #authScreen { height: 90vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .logo { font-size: 28px; font-weight: bold; margin-bottom: 30px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .nav-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; max-width: 400px; margin: 0 auto 30px; }
        .nav-btn { background: #3498db; color: white; border: none; padding: 15px; border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .btn-exit { background: #e74c3c; }

        .white-bubble { background: white; color: #333; padding: 30px; border-radius: 30px; max-width: 450px; margin: 0 auto; min-height: 250px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); display: flex; flex-direction: column; justify-content: center; }
        
        /* –¢–≤–æ—è –Ω–æ–≤–∞—è —Å–ø–æ–∫–æ–π–Ω–∞—è –æ–±–≤–æ–¥–∫–∞ */
        .card-display { font-size: 32px; font-weight: bold; padding: 60px 20px; border: 2px solid #e0e0e0; border-radius: 20px; cursor: pointer; margin-bottom: 20px; color: #2c3e50; min-height: 100px; display: flex; align-items: center; justify-content: center; }
        
        .login-btn { background: #2ecc71; color: white; padding: 18px 50px; border-radius: 15px; font-size: 18px; border: none; font-weight: bold; cursor: pointer; }
        .save-btn { background: #3498db; color: white; border: none; padding: 16px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; font-size: 16px; }

        textarea { width: 100%; height: 200px; padding: 15px; margin-bottom: 15px; border-radius: 15px; border: 2px solid #ddd; box-sizing: border-box; font-size: 16px; font-family: inherit; resize: none; outline: none; }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="logo">üöÄ English Pro</div>
        <button class="login-btn" onclick="login()">–í–û–ô–¢–ò –° GOOGLE</button>
    </div>

    <div id="mainApp" style="display:none;">
        <div class="logo">üöÄ My English App</div>
        
        <div class="nav-menu">
            <button class="nav-btn" onclick="showTab('cardsTab')">üìÇ –ö–∞—Ä—Ç–æ—á–∫–∏</button>
            <button class="nav-btn" onclick="alert('–°–∫–æ—Ä–æ!')">üìù –≠–∫–∑–∞–º–µ–Ω</button>
            <button class="nav-btn" onclick="showTab('addTab')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="nav-btn btn-exit" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
        </div>

        <div class="white-bubble">
            <div id="cardsTab" class="tab-content">
                <div id="cardBox"></div>
                <button class="save-btn" style="background: #95a5a6;" onclick="drawCard()">–°–ª–µ–¥—É—é—â–µ–µ ‚Üí</button>
            </div>

            <div id="addTab" class="tab-content" style="display:none;">
                <textarea id="bulkInput" placeholder="apple;—è–±–ª–æ–∫–æ&#10;dog;—Å–æ–±–∞–∫–∞"></textarea>
                <button class="save-btn" onclick="addBulkWords()">–°–û–•–†–ê–ù–ò–¢–¨ –°–ü–ò–°–û–ö</button>
            </div>
        </div>
    </div>

</body>
</html>
