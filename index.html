<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My English App Sync</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB7vbQ1BQya7SWIsGByt6pLtnkX-0WG1I8",
            authDomain: "llla-f3cd0.firebaseapp.com",
            projectId: "llla-f3cd0",
            storageBucket: "llla-f3cd0.firebasestorage.app",
            messagingSenderId: "976940645729",
            appId: "1:976940645729:web:0a6a820a6a76156cf11920"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({ prompt: 'select_account' });

        let state = { words: [], streak: 0 };
        let currentTest = [];
        let curIdx = 0;

        window.login = () => signInWithPopup(auth, provider).catch(e => alert(e.message));
        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                if (snap.exists()) state = snap.data();
                else await setDoc(userRef, state);
                showTab('cardsTab');
            } else {
                document.getElementById('authScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
            }
        });

        window.showTab = (id) => {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if (id === 'cardsTab') drawCard();
        };

        window.drawCard = () => {
            const cardBox = document.getElementById('cardBox');
            if (!state.words || state.words.length === 0) {
                cardBox.innerHTML = "–î–æ–±–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ –≤ –º–µ–Ω—é '+'";
                return;
            }
            const w = state.words[Math.floor(Math.random() * state.words.length)];
            cardBox.innerHTML = `<div class="card-display" onclick="this.innerText = (this.innerText === '${w.ru}' ? '${w.en}' : '${w.ru}')">${w.ru}</div>`;
        };

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ú–ê–°–°–û–í–û–ì–û –î–û–ë–ê–í–õ–ï–ù–ò–Ø
        window.addWord = async () => {
            const area = document.getElementById('enIn');
            const singleRu = document.getElementById('ruIn');
            const text = area.value.trim();
            
            if (!text) return alert("–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞!");

            let newWordsCount = 0;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å—Ç–∞–≤–ª–µ–Ω –ª–∏ —Å–ø–∏—Å–æ–∫ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∏–ª–∏ –µ—Å—Ç—å ';')
            if (text.includes(';') || text.includes('\n')) {
                const lines = text.split('\n'); // —Ä–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —Å—Ç—Ä–æ–∫–∏
                lines.forEach(line => {
                    const parts = line.split(';');
                    if (parts.length >= 2) {
                        state.words.push({ en: parts[0].trim(), ru: parts[1].trim() });
                        newWordsCount++;
                    }
                });
            } else {
                // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –¥–≤–∞ –ø–æ–ª—è
                const ruVal = singleRu.value.trim();
                if (text && ruVal) {
                    state.words.push({ en: text, ru: ruVal });
                    newWordsCount++;
                } else {
                    return alert("–î–ª—è –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–∞ –ø–æ–ª—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç '—Å–ª–æ–≤–æ;–ø–µ—Ä–µ–≤–æ–¥'");
                }
            }

            if (newWordsCount > 0) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { words: state.words });
                area.value = '';
                singleRu.value = '';
                alert(`–£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–ª–æ–≤: ${newWordsCount}`);
                drawCard();
            }
        };

    </script>
    <style>
        body { background: #1a1a2e; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; text-align: center; }
        #authScreen { height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .logo { font-size: 24px; font-weight: bold; margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .nav-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; max-width: 500px; margin: 0 auto 20px; }
        .nav-btn { background: #3498db; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .white-bubble { background: white; color: #333; padding: 30px; border-radius: 25px; max-width: 500px; margin: 0 auto; min-height: 250px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .card-display { font-size: 32px; font-weight: bold; padding: 40px; border: 2px dashed #3498db; border-radius: 15px; cursor: pointer; margin-bottom: 20px; }
        .main-btn { background: #3498db; color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; font-size: 16px; }
        .login-btn { background: #2ecc71; color: white; padding: 15px 40px; border-radius: 15px; font-size: 18px; border: none; font-weight: bold; cursor: pointer; }
        /* textarea –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—Å—Ç–∞–≤–∫–∏ —Å–ø–∏—Å–∫–∞ */
        textarea { width: 100%; height: 120px; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; font-family: inherit; resize: none; }
        input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
    </style>
</head>
<body>

    <div id="authScreen">
        <div class="logo">üöÄ English Pro</div>
        <button class="login-btn" onclick="login()">–í–û–ô–¢–ò –° GOOGLE</button>
    </div>

    <div id="mainApp" style="display:none;">
        <div class="logo">üöÄ My English App</div>
        <div class="nav-menu">
            <button class="nav-btn" onclick="showTab('cardsTab')">üóÇÔ∏è –ö–∞—Ä—Ç–æ—á–∫–∏</button>
            <button class="nav-btn" onclick="showTab('testTab')">üìù –≠–∫–∑–∞–º–µ–Ω</button>
            <button class="nav-btn" onclick="showTab('addTab')">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="nav-btn" style="background: #e74c3c;" onclick="logout()">üö™ –í—ã—Ö–æ–¥</button>
        </div>

        <div class="white-bubble">
            <div id="cardsTab" class="tab-content">
                <div id="cardBox"></div>
                <button class="main-btn" style="background: #7f8c8d;" onclick="drawCard()">–°–ª–µ–¥—É—é—â–µ–µ ‚Üí</button>
            </div>

            <div id="addTab" class="tab-content" style="display:none;">
                <p style="font-size: 14px; color: #666; margin-bottom: 10px;">–í—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ (—Å–ª–æ–≤–æ;–ø–µ—Ä–µ–≤–æ–¥) –∏–ª–∏ –æ–¥–Ω–æ —Å–ª–æ–≤–æ:</p>
                <textarea id="enIn" placeholder="apple;—è–±–ª–æ–∫–æ&#10;dog;—Å–æ–±–∞–∫–∞&#10;cat;–∫–æ—à–∫–∞"></textarea>
                <input id="ruIn" placeholder="–ü–µ—Ä–µ–≤–æ–¥ (–µ—Å–ª–∏ –≤–≤–µ—Ä—Ö—É —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ)">
                <button class="main-btn" onclick="addWord()">–°–û–•–†–ê–ù–ò–¢–¨ –í–°–Å</button>
            </div>
        </div>
    </div>

</body>
</html>
